
# CRM Demo

Минимальный пример CRM на HTML/JavaScript и PHP. Система хранит данные в `database.json` и поддерживает работу с клиентами, сделками, задачами, базой знаний и чатом сотрудников.

## Запуск
1. Установите PHP 7.4+.
2. Запустите сервер командой:
   ```bash
   php -S localhost:8000
   ```
3. Откройте `http://localhost:8000/index.html` в браузере.

## Структура проекта
- `index.html` – интерфейс CRM. При выборе разделов загружаются JS‑модули из каталога `modules/`.
- `modules/` – подпапки с кодом каждого раздела (`clients`, `deals`, `tasks` и т.д.).
- `api/index.php` – единая точка входа API, которая подключает PHP‑модули из `modules/`.
- `db.php` – функции загрузки и сохранения `database.json` (создаётся автоматически).

## API
Доступные действия для каждого раздела аналогичны прежним. Запросы выполняются по адресу:
`api/index.php?section=<module>&action=<action>`.
Пример: `section=clients&action=get_clients`.

`export_data` позволяет скачать текущий `database.json` целиком.

Для добавления сущностей используйте POST‑запрос с JSON‑телом.

### Пример запроса добавления клиента
```bash
curl -X POST -d '{"name":"Иван","company":"ООО Ромашка","phone":"123456"}' \
     http://localhost:8000/api/index.php?section=clients&action=add_client
```

## Кастомизация
Интерфейс строится из модулей в каталоге `modules/`. При необходимости можно добавлять новые разделы и виджеты, подключая их через `index.html`.

## Автоматические PR и предотвращение конфликтов
В проекте настроены правила для минимизации конфликтов при слиянии изменений, особенно от автоматических инструментов (Codex, Dependabot и др.). Основные приёмы:

1. **"Горячие" файлы**. Для файлов `CHANGELOG.md` и `database.json` используется стратегия `merge=union` (см. `.gitattributes`). Это позволяет безопасно склеивать изменения, если разные ветки только дописывают данные.
2. **Фрагменты changelog**. Вместо единого файла новые записи добавляются в каталог `changelog/fragments/`. Итоговый `CHANGELOG.md` собирается перед релизом.
3. **Auto-rebase**. Для PR от бота `codex-bot` настроен workflow `.github/workflows/auto-rebase.yml`, который автоматически ребейзит ветку при обновлении `main`.
4. **Auto-merge**. Если все статусы CI зелёные и проставлена метка `auto-merge`, GitHub сольёт PR автоматически.

Следование этим правилам позволяет избегать ручных конфликтов вида `<<<<<<<` / `=======` / `>>>>>>>`.
