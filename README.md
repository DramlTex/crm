
# CRM Demo

Минимальный пример CRM на HTML/JavaScript и PHP. Система хранит данные в `database.json` и поддерживает работу с клиентами, сделками, задачами и базой знаний.

## Запуск
1. Установите PHP 7.4+.
2. Запустите сервер командой:
   ```bash
   php -S localhost:8000
   ```
3. Откройте `http://localhost:8000/index.html` в браузере.

## Структура проекта
- `index.html` – интерфейс CRM с разделами "Клиенты", "Сделки", "Задачи", "Документы" и "База знаний".
- `api.php` – API для чтения и записи данных в `database.json`.
- `database.json` – файл‑хранилище (создаётся автоматически).

## API
Доступные действия:
- `get_clients`, `add_client`
- `get_deals`, `add_deal`
- `get_tasks`, `add_task`
- `get_documents`, `add_document`
- `get_articles`, `add_article`
- `get_settings`, `update_settings`
- `get_stages`, `add_stage`
- `export_data`

`export_data` позволяет скачать текущий `database.json` целиком.

Все запросы выполняются через `api.php?action=...`. Для добавления сущностей используйте POST‑запрос с JSON‑телом.

### Пример запроса добавления клиента
```bash
curl -X POST -d '{"name":"Иван","company":"ООО Ромашка","phone":"123456"}' \
     http://localhost:8000/api.php?action=add_client
```

## Кастомизация
Файл `index.html` содержит стили и JavaScript. Интерфейс можно настроить через раздел "Настройки" или изменив код, добавив свои разделы и виджеты.

## Автоматические PR и предотвращение конфликтов
В проекте настроены правила для минимизации конфликтов при слиянии изменений, особенно от автоматических инструментов (Codex, Dependabot и др.). Основные приёмы:

1. **"Горячие" файлы**. Для файлов `CHANGELOG.md` и `database.json` используется стратегия `merge=union` (см. `.gitattributes`). Это позволяет безопасно склеивать изменения, если разные ветки только дописывают данные.
2. **Фрагменты changelog**. Вместо единого файла новые записи добавляются в каталог `changelog/fragments/`. Итоговый `CHANGELOG.md` собирается перед релизом.
3. **Auto-rebase**. Для PR от бота `codex-bot` настроен workflow `.github/workflows/auto-rebase.yml`, который автоматически ребейзит ветку при обновлении `main`.
4. **Auto-merge**. Если все статусы CI зелёные и проставлена метка `auto-merge`, GitHub сольёт PR автоматически.

Следование этим правилам позволяет избегать ручных конфликтов вида `<<<<<<<` / `=======` / `>>>>>>>`.
