# План оптимизации и реорганизации кода

Ниже приведены шаги для разделения функций по разным файлам и
перехода к более модульной структуре при работе с единой базой данных.

## 1. Структура каталогов
Предлагается создать каталог `modules/` и выделить в нём подпапки
для каждого раздела интерфейса:

```
modules/
  clients/
    clients.php
    clients.js
  deals/
    deals.php
    deals.js
  tasks/
    tasks.php
    tasks.js
  ...
```

Каждая папка будет содержать собственный PHP‑файл API и скрипт с функциями
интерфейса. Общие стили и вспомогательные функции можно вынести в `assets/`.

## 2. Единая точка входа API
Создайте общий файл `api/index.php`, который подключает нужный модуль
в зависимости от параметра `section`. Пример:

```php
// api/index.php
$section = $_GET['section'] ?? '';
switch ($section) {
    case 'clients':   require __DIR__.'/../modules/clients/clients.php'; break;
    case 'deals':     require __DIR__.'/../modules/deals/deals.php';   break;
    // остальные разделы
    default: echo json_encode(['error'=>'unknown section']);
}
```

Каждый модуль получает доступ к единой базе данных
(например, через функцию `load_db()` в отдельном файле `db.php`).

## 3. Выделение кода интерфейса
JavaScript из `index.php` рекомендуется перенести в отдельные файлы
в каталоге `modules/<name>/<name>.js` и подключать их при загрузке
соответствующего раздела. Это облегчит поддержку и расширение функций.

Пример для раздела клиентов:

```html
<script type="module" src="modules/clients/clients.js"></script>
```

## 4. База данных
На первом этапе можно продолжать использовать `database.json`.
Файл `db.php` будет содержать функции:

```php
function load_db() {
    return json_decode(file_get_contents(__DIR__.'/../database.json'), true);
}
function save_db($data) {
    file_put_contents(__DIR__.'/../database.json', json_encode($data, JSON_UNESCAPED_UNICODE));
}
```

Позднее можно заменить хранение в файле на SQLite или MySQL
без изменения логики модулей, оставив единый интерфейс `load_db()`/`save_db()`.

## 5. Роутинг на стороне клиента
Меню в `index.php` можно переписать так, чтобы каждая кнопка
подгружала свой JavaScript‑модуль. В модуле располагаются функции
`loadClients()`, `addClient()` и т. д. Внутри модуля выполняются
запросы к `api/index.php?section=clients&action=...`.

## 6. Пример последовательности действий
1. Создать каталог `modules` и добавить в него папки `clients`, `deals`, `tasks` и т. д.
2. Вынести из `api.php` код для работы с клиентами в `modules/clients/clients.php`.
   Аналогично для остальных сущностей.
3. Реализовать файл `api/index.php` для маршрутизации запросов.
4. Переписать JavaScript‑часть, разделив функции по файлам модулей.
5. Обновить `index.php`, оставив только каркас страницы и загрузку нужных модулей.
6. Проверить, что все действия работают через общую базу данных.
7. Обновить документацию и описание API в `README.md`.

Следуя этому плану можно постепенно перейти от монолитных файлов к
более удобной и расширяемой структуре, сохранив при этом текущую функциональность.
